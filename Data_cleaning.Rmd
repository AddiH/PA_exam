---
title: "Data_cleaning"
author: "Astrid Elmann"
date: "1/19/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(tidyverse, readbulk)
```

```{r, message = FALSE}
# load data
d <- read_bulk(
  directory = 'logfiles',
  fun = read_csv
  )
```

```{r}
glimpse(d)
```


### Fix input mistake
```{r}
d <- d %>% 
  mutate(
    age = ifelse(age == "Tysk", "80", age))
```


### Check that no ID's are aciddentially identical
```{r}
# Check that these two dfs have the same number of rows
ID <- d %>% 
  group_by(experiment_ID) %>% 
  count(experiment_ID)

files <- d %>% 
  group_by(File) %>% 
  count(File)

# And this is double that (Might have one xtra "none", this will be removed later)
subjects <- d %>% 
  group_by(subject) %>% 
  count(subject)
```

### Remove slow trials
```{r}
d <- d %>% 
  # Trials where response was not within 1500 ms
  filter(key_press != "none")
```

### Remove colorblind, lefthanded (and ambidextrous) and people with poor vision
```{r}
d <- d %>% 
    filter(colorvision == "No" | colorvision == "Yes, but I can clearly tell the difference between blue and yellow") %>% 
    filter(vision == "Yes") %>% 
    filter(handedness == "Right")
```

### Check the r_len variable
```{r}
unique(d$r_len)
```

### Check the nationality variables
```{r}
unique(d$nationality)
```

### Add congruency column
```{r}
d <- d %>% 
  mutate(
    congruency = ifelse(trial_stim == "BR" | trial_stim == "YL", 'congruent', 'incongruent'),
    congruency = ifelse(trial_stim == 'BM' | trial_stim == "YM", 'neutral', congruency),
    congruency = as.factor(congruency),
  )
```

### Add accuracy column
```{r}
d <- d %>% 
  mutate(
    accuracy = ifelse(
      ((trial_stim == "BR" | trial_stim == "BM" | trial_stim == "BL") & key_press == "p") |
      ((trial_stim == "YR" | trial_stim == "YM" | trial_stim == "YL") & key_press == "w"), 
      'correct', 'error'),
    accuracy = as.factor(accuracy)
  )

# Getting no. of error trials
table(d$accuracy)["error"]
```

### Remove rt +- 3 SD
```{r}
# Define upper and lower boundaries
upper <- mean(d$rt) + 3 * (sd(d$rt))
lower <- mean(d$rt) - 3 * (sd(d$rt))

d <- d %>% 
  filter(rt <= upper) %>% 
  filter(rt >= -lower)

```

### Save the df
```{r}
write_csv(d, "clean_data.csv")
```


